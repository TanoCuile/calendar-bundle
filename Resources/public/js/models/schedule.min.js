function initializeSchedule(a){a.Schedule=Backbone.Model.extend({defaults:{workDays:null,owner:null,ownerType:null,supplyTo:null,supplyFrom:null,nominalSchedule:null,isSetSupply:true},dayNames:{1:"Пн",2:"Вт",3:"Ср",4:"Чт",5:"Пт",6:"Сб",7:"Вс"},save_url:"/api/calendar/schedule/save",save_master_url:"/api/calendar/schedule/master/save",initialize:function(c){if(!c){c={}}if(!c.workDays){c.workDays={}}if(c.nominalSchedule){this.set("nominalSchedule",c.nominalSchedule)}var e=[];this.set("supplyTo",this.parseSupply(c.supplyTo));this.set("supplyFrom",this.parseSupply(c.supplyFrom));for(var d=1;d<8;++d){if(this.get("nominalSchedule")&&!this.get("nominalSchedule").get("workDays")[d-1].get("active")){continue}var b={dayName:this.dayNames[d],dayId:d};if(c.workDays[d]){_.extend(b,c.workDays[d])}e.push(new a.WorkDay(b))}this.set("workDays",e)},parseSupply:function(b){if(!b){return null}b=parseInt(b);var c=new Date();if(b){c.setMonth(Math.floor(b/100));c.setDate(b%100)}return c},checkSupply:function(b){if((this.get("supplyTo")&&this.get("supplyFrom"))&&(b.getTime()<this.get("supplyTo").getTime()&&b.getTime()>this.get("supplyFrom").getTime())){return false}return true},calculateSupply:function(c){if(!c){return null}if(typeof(c)=="object"){return c.getMonth()*100+c.getDate()}else{if(c.indexOf("/")>-1){c=c.split("/");var d=c[0];var b=c[1]}else{c=c.split(".");var d=c[1];var b=parseInt(c[0])}if(d[0]=="0"){d=d[1]}d=parseInt(d)-1;if(b[0]==0){b=b[1]}return d*100+b}},getDay:function(b){var c=null;_.each(this.get("workDays"),function(d){if(d.get("dayId")==b){c=d;return{}}});return c},save:function(){$.ajax({url:this.save_url,type:"POST",data:{schedule:this.toJSON()}}).success(function(b){if(b.status==1){}})},toJSON:function(){var b={owner:this.get("owner"),ownerType:this.get("ownerType")};b.supplyFrom=this.calculateSupply(this.get("supplyFrom"));b.supplyTo=this.calculateSupply(this.get("supplyTo"));var c=[];_.each(this.get("workDays"),function(e){var d=e.toJSON();if(d){c.push(d)}});b.workDays=c;return b},validate:function(){var b=true;if(this.get("nominalSchedule")){_.each(this.get("workDays"),function(c,d){if(c.get("active")&&!this.get("nominalSchedule").get("workDays")[d].get("active")){c.set("active",false)}else{if(c.get("active")){if(!c.validate(this.get("nominalSchedule").get("workDays")[d].get("fromTime"),this.get("nominalSchedule").get("workDays")[d].get("toTime"))){b=false}}}}.bind(this))}return b}},{checkDay:function(c,b){},additionalCheck:function(){}});a.WorkDay=Backbone.Model.extend({defaults:{dayId:1,active:false,fromTime:8*60,toTime:22*60,fromMin:0,toMin:0,fromHour:0,toHour:0,dayName:"",salon:null,salonName:null,current:false,weekend:false,formattedToTime:0,formattedFromTime:0,fromTimeError:false,toTimeError:false,fromTimeErrorText:"",toTimeErrorText:""},salons:null,defaultWorkPlace:{id:0,name:"На дому"},setToTime:function(){this.attributes.formattedToTime=(this.getHours(this.get("toTime"))*100)+(parseInt(this.get("toTime"))%60);if(this.attributes.formattedToTime<1000){this.attributes.formattedToTime="0"+this.attributes.formattedToTime}},setFromTime:function(){this.attributes.formattedFromTime=(this.getHours(this.get("fromTime"))*100)+(parseInt(this.get("fromTime"))%60);if(this.attributes.formattedFromTime<1000){this.attributes.formattedFromTime="0"+this.attributes.formattedFromTime}},parseFormatted:function(b){if(typeof(b)=="string"&&b[0]=="0"){b=b.slice(1)}if(typeof(b)=="string"){b=parseInt(b.replace(":",""))}return Math.floor(b/100)*60+b%100},format:function(d){if(typeof(d)=="string"){d=parseInt(d)}var c=(d%60);var b=Math.floor(d/60);return(b>=10?b:"0"+b)+":"+(c>=10?c:"0"+c)},initialize:function(b){if(this.get("dayId")==0||this.get("dayId")==6){this.set("weekend",true)}if(b.id){this.set("active",true)}if(b.timeFrom){this.set("fromTime",parseInt(b.timeFrom))}if(b.timeTo){this.set("toTime",parseInt(b.timeTo))}this.setToTime();this.setFromTime();this.on("change:toTime",this.setToTime.bind(this));this.on("changeFromTime",this.setFromTime.bind(this));this.on("change:formattedToTime",function(){this.attributes.toTime=this.parseFormatted(this.get("formattedToTime"))}.bind(this));this.on("change:formattedFromTime",function(){this.attributes.fromTime=this.parseFormatted(this.get("formattedFromTime"))}.bind(this))},setName:function(b){this.set("dayName",b)},getHours:function(b){return Math.floor(parseInt(b)/60)},getMinutes:function(c){var b=parseInt(c)%60;if(b<10){b="00"}return b},toJSON:function(){if(!this.get("active")){return false}var c={dayId:this.get("dayId"),timeFrom:this.get("fromTime"),timeTo:this.get("toTime")};if(this.get("salon")){var b=this.get("salon");if(_.has(b,"attributes")){c.salon=b.toJSON()}else{c.salon=b}}return c},validate:function(b,c){var d=true;if(this.get("fromTime")>this.get("toTime")&&this.get("toTime")!=0){d=false;this.set("fromTimeError","Должно быть меньше времени окончания ("+this.format(this.get("toTime"))+")");this.set("toTimeError","Должо быть больше времени начала ("+this.format(this.get("fromTime"))+")");return d}if(b>this.get("fromTime")){d=false;this.set("fromTimeError","Должно быть не меньше начала вашей работы ("+this.format(b)+")")}else{this.set("fromTimeError",false)}if(c<this.get("toTime")){d=false;this.set("toTimeError","Должно быть не больше окончания вашей работы ("+this.format(c)+")")}else{this.set("toTimeError",false)}return d}},{});rivets.binders.day_salon=function(b,c){}};