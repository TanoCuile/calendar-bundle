if(!window.MainElements){window.MainElements={}}if(!window.MainElements.initAppCallStack){window.MainElements.initAppCallStack=[]}window.MainElements.initAppCallStack.push(function(a){a.factory("DateManager",[function(){function b(c){angular.extend(this,c);this.getSupplyBoundaries=function(){var f=null;var e=null;function d(g){return{month:Math.floor(g/100),day:g%100}}if(c.supplyFrom){f=d(c.supplyFrom)}if(c.supplyTo){e=d(c.supplyTo)}return{from:f,to:e}};this.getWorkDay=function(d){if(this.workDays[d.isoWeekday()]){return this.workDays[d.isoWeekday()]}return null}}return{timeSectionDuration:15,timeSectionHeight:12,prepareSchedule:function(c){return new b(c)},prepareDate:function(c){if(!c){return moment()}return moment(c)},checkSupply:function(c,e){var d=e.getSupplyBoundaries();if(d.from&&d.to(d.from.month>c.month()||(d.from.month==c.month()&&d.from.day>c.date()))&&(d.to.month<c.month()||(d.to.month==c.month()&&d.to.day<c.date()))){return true}else{if(d.from){if(d.from.month>c.month()||(d.from.month==c.month()&&d.from.day>c.date())){return true}}else{if(d.to){if(d.to.month<c.month()||(d.to.month==c.month()&&d.to.day<c.date())){return true}}else{return true}}}return false},checkDateAvailable:function(d,h,e){if(!e){if(h.getWorkDay(d)&&this.checkSupply(d,h)){return true}}else{var c=d.startOf("week");var g=d.endOf("week");if(this.checkSupply(c,h)||this.checkSupply(g,h)){var f=true;return f}}return false},getAvailableDate:function(d,h,f,c){var g=!f?1:7;if(c){g=-1*g}var e=0;while(e<365){d=d.add(g,"d");if(this.checkDateAvailable(d,h,f)){return d}e++}},checkDateInCurrentWeek:function(c,d){return !!d[c.startOf("day")]},getWeekDays:function(c,h){var f=c.startOf("week");var e={};for(var d=1;d<7;++d){var g=f.add(d,"day");if(h.workDays[d-1]&&this.checkSupply(g,h)){e[g.unix()]=h.workDays[d-1]}}return e},getCurrentDayFromWeek:function(c,d){if(d[c.startOf("day").unix()]){return d[c.startOf("day").unix()]}return null},getWeekTimeSections:function(d){var c=this;var f=null;var e=null;angular.forEach(d.workDays,function(g){if(g.timeFrom<f||f==null){f=g.timeFrom}if(g.timeTo>e||e==null){e=g.timeTo}return c.calculateTimeSections(f,e)})},getDayTimeSections:function(c){return this.calculateTimeSections(c.timeFrom,c.timeTo)},setGreatTimeStateOptions:function(c,d){c[d].height=c[d].sections.length;c[d].display={height:c[d].height*this.timeSectionHeight}},calculateTimeSections:function(j,h){var c={};var e=true;var g=j;var f=false;for(var d=j;d<h;d+=this.timeSectionDuration){if(e){if(c[g]){this.setGreatTimeStateOptions(c,g)}g=d;c[g]={time:this.formatTime(d),odd:f,sections:[]};f=!f}c[g].sections.push({time:this.formatTime(d),display:{height:this.timeSectionHeight}});e=d%60==45}this.setGreatTimeStateOptions(c,g);return c},formatTime:function(c){return Math.floor(c/60)+":"+(c%60>10?c%60:"00")},timeToPixel:function(c){return c/this.timeSectionDuration*this.timeSectionHeight},pixelToTime:function(c){return c/this.timeSectionHeight*this.timeSectionDuration},generateDateString:function(d){var c=moment();if(c.year()!=d.year()){return d.format("D dd MM YYYY")}else{if(c.month()!=d.month()){return d.format("D dd, MMMM")}else{return d.format("D dddd")}}}}}])});