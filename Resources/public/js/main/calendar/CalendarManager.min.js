if(!window.MainElements){window.MainElements={}}if(!window.MainElements.initAppCallStack){window.MainElements.initAppCallStack=[]}window.MainElements.initAppCallStack.push(function(a){a.factory("CalendarManager",["CalendarData","DateManager","ScheduledDataFactory","PlateFactory","NoteManager","$routeParams",function(d,h,j,n,l,k){function g(){var o={};f(d.view.weekTimeSections,o);return o}function f(q,p){var o=0;angular.forEach(q,function(r){o+=r.height});p.height=o*(h.timeSectionHeight+1)+36}function b(){var o={};f(d.view.dayTimeSections,o);return o}function i(){d.account.schedule=h.prepareSchedule(d.account.schedule);angular.forEach(d.columns,function(o){o.schedule=h.prepareSchedule(o.schedule)});d.weekPlates={};d.dayPlates={};d.view.weekTimeSections=h.getWeekTimeSections(d.account.schedule);d.view.weekStyle=g();d.changeDate(d.date?d.date:new Date())}function c(p){var q=h.getWeekDays(p,d.account.schedule);var o={};var r={};angular.forEach(q,function(s,t){o[t]=j.generateScheduledBlanks(s,d.columns);r[t]={};angular.forEach(o[t],function(u){angular.forEach(u.column.categories,function(v){if(!r[t][v]){r[t][v]={}}r[t][v][u.column.id]=n.generatePlate(u,d.servicesHierarchy[v])})})});d.weekBlanks=o;d.week=r;e(d.weekBlanks);return q}function e(o){console.log("BLANKS",o)}function m(o){d.currentDay=h.getCurrentDayFromWeek(o,d.week);d.view.dayTimeSections=h.getDayTimeSections(d.account.schedule.getWorkDay(o));d.view.dayStyle=b();angular.forEach(d.columns,function(q){var p=d.account.schedule.getWorkDay(o);q.setWorkDay(q.schedule.getWorkDay(o),p.timeFrom,p.timeTo)})}d.checkDateAvailable=function(o,p){if(!h.checkDateAvailable(o,p)){return false}};d.changeDate=function(p,o){p=h.prepareDate(p);if(!d.checkDateAvailable(p,d.account.schedule)){p=h.getAvailableDate(p,d.account.schedule,d.weekMode,o)}d.date=p;if(h.checkDateInCurrentWeek(p,d)){m(p)}else{c(p);m(p)}d.dateStr=h.generateDateString(p)};i();console.log("CALENDAR",d);return d}])});