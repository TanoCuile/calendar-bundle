if(!window.MainElements){window.MainElements={}}if(!window.MainElements.initAppCallStack){window.MainElements.initAppCallStack=[]}MainElements.initAppCallStack.push(function(a){a.factory("PlateFactory",["ScheduledDataFactory","DateManager",function(c,e){var d=function(g,f){this.blank=g;this.category=f;this.runnerData={show:false,onRunner:false,display:{top:0}};this.createNote=function(h,i){this.blank.createNote(e.pixelToTime(b.preparePosition(h))+this.blank.getPlanStart(),i?i:b.defaultDuration)}};var b={defaultDuration:60,generatePlate:function(g,f){return new d(g,f)},preparePosition:function(f){return f-f%e.timeSectionHeight}};return b}]);a.directive("calendarPlate",["PlateFactory","DateManager",function(b,c){return{restrict:"E",templateUrl:"/bundles/calendar/html/plate.html.tpl",replace:true,scope:{plate:"="},link:function(d,f,e){function g(h){if(typeof(h)=="object"){return h.pageY-f.offset().top}else{return event-f.offset().top}}d.onDrop=function(i,h){console.log("Test",b.preparePosition(g(h.event)));i.setFromTime(b.preparePosition(c.pixelToTime(g(h.event)))+d.plate.blank.getPlanStart())};d.onDrag=function(i,h){console.log("Drag success",i,h)};d.setRunner=function(){d.plate.runnerData.fixed=true};d.addNote=function(h){console.log("sdsdsd",h);d.plate.createNote(g(h))};d.activatePlate=function(){if(!d.plate.runnerData.onRunner){d.plate.runnerData.show=true}};d.disactivatePlate=function(){if(!d.plate.runnerData.onRunner){d.plate.runnerData.show=false}};d.onDragStop=function(i,h){console.log("TRST",i,h)};d.runnerChangePosition=function(h){d.plate.runnerData.top=b.preparePosition(g(h))}}}}]);a.directive("calendarPlateRunner",[function(){return{restrict:"E",templateUrl:"/bundles/calendar/html/runner-field.html.tpl",replace:true,scope:{data:"="},link:function(c,d,b){c.$watch("data.top",function(e){c.data.display.top=e})}}}])});