function initializeMasterDayCalendar(a){a.MasterDayCaledar=a.BaseCalendarView.extend({loadDateNotesUrl:"/api/calendar/order/load/date",weekCalendar:{},dayCalendar:{},fromTime:null,toTime:null,customInitialize:function(c){if(c.salons){this.options.salons={};_.each(c.salons,function(d){this.options.salons[d.id]=new a.EvenSalon(d)}.bind(this))}this.options.dayOptions={};this.options.days={};var b=this.getWeekDays(this.options.date);_.each(b,function(d,f){var e=this.getWorkDay(d.day);if(e.get("active")){this.options.days[f]=d}}.bind(this))},compareDay:function(b,c){return Math.floor(b/(1000*60*60*24))==Math.floor(c/(1000*60*60*24))},loadNotes:function(){var b={};_.each(this.options.salons,function(c){b[c.get("id")]=c.model});this.executeForColumns(function(d,c){c.view.clear()});dates=[];_.each(this.options.columns,function(c){dates.push({d:c.day.day.getDate(),m:c.day.day.getMonth()+1,y:c.day.day.getFullYear()})});$.ajax({url:this.loadDateNotesUrl,type:"POST",data:{dates:dates,owners:_.keys(b)}}).success(function(c){if(c.status==1){_.each(c.notes,function(d,f){var e=this.createNoteModel(this.options.date,d.fromTime,d.toTime,b[d.owner.id],d.service,false,false,false,d);this.getColumnView(d.owner.id,d.category,e.get("date")).initializeAddNoteView(e);if(this.options.showNotes.indexOf(d.id.toString())>=0){e.set("edit",true);e.set("showInfo",false);columnView.interfaces[0].showPopup=true}}.bind(this))}}.bind(this))},getColumnView:function(d,g,c){var b=null;var e=this;var f=function(h){if(h.view.model.get("id")==d){b=h.view;return{}}};_.each(this.options.columns,function(h){if(typeof(c)=="string"){if(h.day.day_id==c){_.each(h.columns,f)}}else{if(e.compareDay(h.day.day,c)){_.each(h.columns,f)}}});return b},calculateBuffers:function(c,b){if(typeof(b.model.get("dayId"))=="number"){c.call(c,b.model.get("dayId")+1,this.fromTime,this.toTime)}else{c.call(c,parseInt(b.model.get("dayId"))+1,this.fromTime,this.toTime)}},executeForColumns:function(c){var b=this;_.each(this.options.columns,function(d){_.each(d.columns,function(e){c.call(b,d,e)})})},initializeColumns:function(){var c=this;var b={};_.each(this.options.days,function(e,d){b[d]={day:e,columns:[],salons:[]};_.each(c.options.salons,function(g){var i=new a.ColumnInfo(g.attributes);i.set("dayId",d);var f=new a.ColumnView({model:i,baseInfo:c.options.data,calendarView:c,date:e});var h=f.createInterface(d,e);b[d].columns.push(h);b[d].salons.push(i);i.set("active",true);c.options.data.get("columns").push(i)})});c.options.columns=b},getWorkDay:function(b){return this.options.data.get("schedule").get("workDays")[(b.getDay()>0)?(b.getDay()-1):6]},changeDate:function(c){var d=this.checkNextActiveDay(c);this.options.date=c;if(d.get("active")&&this.options.data.get("schedule").checkSupply(c)){var b=this.getWeekDays(this.options.date);this.options.reload=true;this.dateStrGenerate();var g=null;var e=0;_.each(b,function(i,k){var j=this.getWorkDay(i.day);if(j.get("active")&&this.options.data.get("schedule").checkSupply(c)){this.options.columns[k].day.day=i.day;if(Math.floor(i.day.getTime()/24*3600)==Math.floor(this.options.date.getTime()/24*3600)){this.options.currentDay=this.options.columns[k];this.options.dayOptions.currentDay=k;g=e}e++}}.bind(this));var f=this;_.each(this.options.columns,function(i){_.each(i.columns,function(j){_.each(j.view.model.get("schedule").get("workDays"),function(k){if(k.get("active")&&f.options.data.get("schedule").checkSupply(c)){if(f.fromTime==null||f.fromTime>k.get("fromTime")){f.fromTime=k.get("fromTime")}if(f.toTime==null||f.toTime<k.get("toTime")){f.toTime=k.get("toTime")}}})})});if(g){this.options.nextDay=this.options.columns[_.keys(this.options.columns)[g+1]];this.options.dayOptions.nextDay=g+1;var h=true;if(this.options.nextDay){_.each(this.options.nextDay.columns,function(i){if(i.show){h=false;return{}}})}this.options.hideNext=h}this.options.data.set("currentDay",d);this.initializeRows();this.heightAlgorithm(this);this.loadNotes();this.options.reload=false;this.options.hidden=false}else{MainElements.messageManager.showMessage("Сегодня ("+this.days[c.getDay()]+") вы не работаете.",10000);this.options.hidden=true}this.updateScrollBar()},showWeekCalendar:function(c,b){c.preventDefault();b.view.activateWeekCalendar()},showDayCalendar:function(c,b){c.preventDefault();b.view.activateDayCalendar()},categoryDisableOther:function(c,b){b.data.categoryDisableOther(b.category.id)},categoryToggle:function(c,b){b.data.activateCategory(b.category)},activateAll:function(b,c){c.data.activateAllCategories()},activateWeekAndMasterOnlyCallback:function(c,b){c.preventDefault(true);b.view.activateMasterOnly(b);b.view.activateWeekCalendar();b.view.options.markAbility=true},activateMasterOnly:function(b){_.each(b.data.get("categories"),function(c){_.each(c.masters,function(d){if(b.column.view.model.get("id")!=d.id){d.set("active",false)}})});_.each(b.data.get("categories"),function(c){var d=false;_.each(c.masters,function(e){if(e.get("active")){d=true;return{}}});c.active=d})},activateMaster:function(b){_.each(b.data.get("categories"),function(c){_.each(c.masters,function(d){if(b.column.view.model.get("id")==d.id){c.active=true;d.set("active",true)}})})},checkDatePickerDay:function(d){var c=0;var b=new Date();b.setDate(b.getDate()-1);if(!(d>=b)||!this.options.data.get("schedule").checkSupply(d)){return[false]}var e=this.getWorkDay(d);return[e.get("active")]},choseDayAndDayCalendar:function(c,b){b.view.options.markAbility=true;b.view.activateDayCalendar();b.view.changeDate(b.day_info.day.day)},activateMasterOnlyCallback:function(b,c){b.preventDefault(true);this.activateMasterOnly(c)},activateMasterCallback:function(b,c){b.preventDefault(true)},loadPrev:function(c,b){if(b.data.get("weekCalendar")){b.date=b.view.addDays(b.date,-7)}else{b.date=b.view.addDays(b.date,-1)}b.view.checkPrevActiveDay(b.date);b.view.changeDate(b.date)},loadCurrent:function(c,b){b.view.changeDate(b.date);b.view.checkNextActiveDay(b.date)},loadNext:function(c,b){if(b.data.get("weekCalendar")){b.date=b.view.addDays(b.date,7)}else{b.date=b.view.addDays(b.date,1)}b.view.checkNextActiveDay(b.date);b.view.changeDate(b.date)},activateWeekCalendar:function(){this.options.data.set("weekCalendar",true)},activateDayCalendar:function(){this.options.data.set("weekCalendar",false)},saveMasterSupply:function(c,b){c.preventDefault();b.data.get("schedule").save()}})};