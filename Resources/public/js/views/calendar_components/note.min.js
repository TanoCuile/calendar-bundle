function initializeBaseNote(a){a.BaseNoteView=Backbone.View.extend({topOffset:0,popupOffsetTop:0,popupInfoOffsetTop:0,calendarData:null,columnData:null,customInitialize:function(c){},helps:{name:[],surname:[],phone:[]},onDragStop:null,offsetTop:false,offsetBottom:false,initialize:function(c){this.customInitialize(c);this.model=c.model;this.calendarData=c.calendarData;this.columnData=c.columnData;this.columnView=c.columnView;if(!this.model.get("onEdit")){this.calculateOffsetTop()}this.model.on("changeFromTime",this.calculateOffsetTop.bind(this))},stopPropagation:function(c){c.preventDefault(true);c.stopPropagation(true)},manipulateEement:function(c){if(!this.$elements&&this.$el){c(this.$el)}else{_.each(this.$elements,c)}},calculateOffsetTop:function(){var c=this.calendarData.get("currentDay").get("timeFrom");if(this.columnView.calendarView.fromTime){c=this.columnView.calendarView.fromTime}this.topOffset=a.ColumnInfo.timeToPixels(this.model.get("fromTime")-c);if(this.columnView.calendarView.toTime-380>this.model.get("fromTime")||this.columnView.calendarView.toTime<640){this.popupOffsetTop=a.ColumnInfo.timeToPixels(this.model.get("fromTime")-c)}else{this.popupOffsetTop=a.ColumnInfo.timeToPixels(this.model.get("fromTime")-330-c)}if(this.columnView.calendarView.toTime-250>this.model.get("fromTime")||this.columnView.calendarView.toTime<640){this.popupInfoOffsetTop=a.ColumnInfo.timeToPixels(this.model.get("fromTime")-c)}else{this.popupInfoOffsetTop=a.ColumnInfo.timeToPixels(this.model.get("fromTime")-250-c)}this.manipulateEement(function(d){d.css("top",this.topOffset)}.bind(this));this.trigger("changeTopOffset",this);this.columnView.calculateNoteOffset(this)},showInfo:function(c,d){console.log("PARAMS",d,c);if(c){c.preventDefault(true);c.stopPropagation(true)}console.log("PARAMS",d,this);if(d){d.column.showPopup=true;d.note.model.set("showInfo",true)}else{this.columnView.showPopup=true;this.model.set("showInfo",true)}return false},closePopup:function(c,d){c.preventDefault(true);d.column.showPopup=true;d.note.model.set("showInfo",false);d.note.model.set("edit",false);if(d.note.model.get("new")){d.note.deleteNote(d.column,d.note)}},calculateTime:function(g,c){var d=g-g%12;var f=a.ColumnInfo.pixelsToTime(d)+c;this.model.set("fromTime",f)},approveNote:function(c,d){c.preventDefault(true);c.stopPropagation(true);d.note.model.set("approved",true);if(d.note.model.save()){d.note.model.set("edit",false)}},clickHandler:function(c,d){d.column.showPopup=false;_.each(d.column.notes,function(f){f.edit=false;f.info=false})},editNote:function(c,d){if(e){c.preventDefault(true);c.stopPropagation(true)}d.column.showPopup=true;d.note.model.set("showInfo",false);d.note.model.set("edit",true)},removeNote:function(c,d){c.preventDefault(true);c.stopPropagation(true);d.note.deleteNote(d.column,d.note)},deleteNote:function(d,c){d.showPopup=false;d.view.removeNoteView(c.model);d.view.removeNote(c.model);c.model.remove()},serviceName:function(){if(this.model.get("service")){return this.model.get("service")["name"]}else{return null}},getTopOffset:function(){return this.topOffset},loadByName:function(c){return b},loadBySurname:function(c){return b},loadByPhone:function(c){return b},noteView:function(){},selectService:function(f,d){f.preventDefault(true);var g=$(f.target).val();var c="";_.each(d.column.view.model.get("durations"),function(h){if(h.jobType==g){c=h.name;return{}}});d.note.model.set("service",{id:g,name:c})}});function b(c,d){$.ajax({url:"/api/customer/id",type:"POST",data:{id:d.item.id}}).success(function(f){if(f.phone.length>0){this.model.set("firstName",f.name?f.name:"");this.model.set("lastName",f.lastName?f.lastName:"");this.model.set("phone",f.phone)}}.bind(this))}rivets.formatters.timeToPixel=function(c){if(typeof(c)=="string"){c=parseInt(c)}return c/15*12};rivets.binders["draggable-note"]=function(c,d){if(!d.model.get("static")){setTimeout(function(){$(c).draggable({grid:[1,d.calendarData.get("cellHeight")],snap:".calendar-container",appendTo:".calendar-container",containment:".calendar-container",scroll:true,revert:"invalid",cursor:"move",start:function(){d.model.set("onEdit",true)},stop:function(f,g){d.model.set("onEdit",false);if(d.model.onDragStop){d.model.onDragStop(d,d.model.onDragStopParameters);d.model.onDragStop=null}}})},200)}};rivets.binders["resizable-note"]=function(c,d){if(!d.model.get("static")){setTimeout(function(){$(c).resizable({grid:d.calendarData.get("cellHeight"),containment:"td.work-column",handles:"s",start:function(){d.model.set("onEdit",true)},stop:function(f,g){d.model.set("duration",a.ColumnInfo.pixelsToTime(g.size.height-g.size.height%d.calendarData.get("cellHeight")));d.model.set("onEdit",false);d.model.save()}})},200)}}};