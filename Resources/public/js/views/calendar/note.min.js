function initializeNote(a){a.NoteView=Backbone.View.extend({popupHeight:220,noteContainer:"",noteStyle:"",popupStyle:"",contentStyle:"",showInfo:false,generateContentStyle:function(d,b){var c="";if(this.model.get("reserveStart")){d-=12;b+=12;c+="padding-top:12px"}if(this.model.get("reserveEnd")){b+=12}this.contentStyle="top:"+d+"px;height:"+b+"px;"+c;return{offset:d,height:b}},generatePopupStyle:function(c,b){if(c<this.popupHeight){this.popupStyle="top:"+b+"px;"}else{this.popupStyle="top:-"+this.popupHeight+"px;"}},getDefaultParameters:function(){var c=((this.model.get("fromTime")-this.fromTime)/15*12);var b=((this.model.get("toTime")-this.model.get("fromTime"))/15*12);return{offset:c,height:b}},initialize:function(d){if(d.popupHeight){this.popupHeight=d.popupHeight}this.model=d.model;this.fromTime=d.fromTime;this.toTime=d.toTime;this.calendar=d.calendar;this.noteContainer='<div class="'+(this.model.get("editable")?"editable":"static")+'"></div>';var c=this.getDefaultParameters();var e=c.offset;var b=c.height;if(b>45){this.showInfo=true}this.noteStyle="height:"+b+"px;";this.generatePopupStyle(e,b);this.generateContentStyle(e,b);this.model.on("change:reserveStart",function(){var g=this.getDefaultParameters();var h=g.offset;var f=g.height;this.generateContentStyle(h,f)}.bind(this));this.model.on("change:reserveEnd",function(){var g=this.getDefaultParameters();var h=g.offset;var f=g.height;this.generateContentStyle(h,f)}.bind(this));this.model.on("change:phone",function(){})},getForm:function(){return""},click:function(c,b){c.preventDefault(true);c.stopPropagation();if(!b.note.model.get("edit")){b.data.set("onEdit",true);b.note.model.set("edit",true)}},getDraggableOptions:function(){var b=this;return{grid:[this.calendar.options.colWidth,this.calendar.options.cellHeight],snap:".work-field .master",appendTo:".calendar-field-wrapper",containment:".calendar-field-wrapper",scroll:true,revert:"invalid",cursor:"move",handle:".note-content",stop:function(c,d){if(!b.model.get("isNew")){b.model.save()}}}},closeSettingsPopup:function(c,b){c.preventDefault(true);if(b.note.model){if(b.note.model.attributes.edit&&!b.note.model.get("new")){b.data.set("onEdit",false);b.note.model.attributes.edit=false}else{if(b.note.model.get("new")){b.note.deleteNote(c,b)}}}else{}},saveNote:function(g,d){g.preventDefault(true);var b=d.note.model.get("owner");if(!_.has(b,"attributes")){b=d.data.getMaster(b.id)}var f=d.view.getValidateData(d.view.options,b);var c=d.note.model.validate(f.fromTime,f.toTime,b.get("notes"));if(c){d.note.model.save(function(e){d.note.model.set("new",false);d.note.model.set("edit",false);if(d.noteSaveCallback){d.noteSaveCallback(e,d.note)}})}else{d.note.model.set("errorTime",true)}d.data.set("onEdit",false)},deleteNote:function(c,b){c.preventDefault(true);_.each(b.data.getMaster(b.note.model.get("owner").id).get("noteViews"),function(d,e){if(d&&d.model.id==b.note.model.get("id")){b.data.getMaster(b.note.model.get("owner").id).get("noteViews").splice(e,1)}});_.each(b.data.getMaster(b.note.model.get("owner").id).get("notes"),function(d,e){if(d&&d.get("id")==b.note.model.get("id")){if(!d.get("new")){$.ajax({type:"POST",url:d.delete_url,data:{order:d.get("id")}}).success(function(f){})}b.data.getMaster(b.note.model.get("owner").id).get("notes").splice(e,1)}});b.note.model.set("edit",false);b.data.set("onEdit",false)},tooltipOptions:function(b){var c="";if(b.model.get("name")){c+="[Кнтактное лицо: "+b.model.get("name")+"]"}if(b.model.get("phone")){c+="[Телефон:  +7"+b.model.get("phone")+"]"}return c}});rivets.binders.draggable=function(c,b){if(!$(c).hasClass("approved")&&b.model.get("editable")){$(c).draggable(b.getDraggableOptions())}};rivets.binders.droppable=function(b,c){$(b).droppable(c.getDroppableOptions())};rivets.binders.tooltip=function(c,b){if(b.model.get("duration")<=45){var d=b.tooltipOptions(b);$(c).attr("title",d);$(c).tooltip({content:function(){return $(this).prop("title")}})}}};