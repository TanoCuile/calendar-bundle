function initializeCategoriesSwitcher(a){a.CategoriesSwitcherVeiew=Backbone.View.extend({rivets:null,$scrollPane:null,events:{"click .service-categories .service":"categoryClickHandler"},options:{},defaults:{activeMasters:[],activeCat:0},initialize:function(c){this.options=new a.CalendarInfo(_.extend({},this.defaults,c));this.checkActiveCategory();this.rivets=rivets.bind(this.el,{data:this.options,view:this});if(this.options.get("activeCat")){this.$el.find(".submenu").removeClass("hidden")}var b=this.$el.find(".masters .item-list").jScrollPane({});this.$scrollPane=b.data("jsp");a.calendar=new a.CalendarWidgetView({el:$(".calendar_wrapper")[0],data:this.options});a.jobWidget=new a.JobTypeSwitcherView({el:$(".left-sidebar .job-types")[0],data:this.options})},categoryClickHandler:function(b){b.preventDefault(true);if($(b.target).attr("data-cat")!=this.options.get("activeCat")){this.changeCategory($(b.target).attr("data-cat"))}},changeCategory:function(b){b=parseInt(b);if(b){this.options.set("activeCat",b);_.each(this.options.get("activeMasters"),function(c){c.set("active",false)}.bind(this));_.each(this.options.get("activeMasters"),function(){this.options.get("activeMasters").pop()}.bind(this));_.each(a.categories[b].subElements,function(c){c.active=true;c.inWork=true;c.notes=[];c.noteViews=[];this.options.get("activeMasters").push(new Backbone.Model(c))}.bind(this));this.$el.find(".service-categories li").removeClass("act");this.$el.find(".service-categories li.category-"+b).addClass("act");this.$el.find(".submenu.active").removeClass("active").addClass("hidden");this.$el.find(".submenu.cat-"+b).removeClass("hidden").addClass("active");this.$el.find(".submenu.cat-"+b+" .item a").addClass("active");this.$el.find(".submenu .item-container").css("width",this.options.get("activeMasters").length*180);if(this.$scrollPane){this.$scrollPane.reinitialise()}this.options.trigger("change:activeMasters")}},checkActiveCategory:function(){var b=this.$el.find(".service-categories li.act");if(!b){b=this.$el.find(".service-categories li:first");if(b){b.addClass("act")}}if(!b){MainElements.messageManager.showMessage('У вас нет активных услуг. Настройте предлагаемые услыги в разделе <a href="/salon/services">"Услуги"</a>',9000)}else{this.changeCategory(b.find("a").attr("data-cat"))}},masterClickHandler:function(c,b){c.preventDefault(true);_.each(b.view.options.get("activeMasters"),function(d){if(d.id==parseInt($(c.target).attr("data-master"))){if(d.get("active")){d.set("active",false)}else{d.set("active",true)}}})},clickParent:function(c,b){c.target=$(c.target).parent()[0];b.view.masterClickHandler(c,b)}})};