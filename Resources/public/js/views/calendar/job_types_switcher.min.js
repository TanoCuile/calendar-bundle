function initializeJobTypeSwitcher(a){a.JobTypeSwitcherView=Backbone.View.extend({rivets:null,data:null,options:{},defaults:{types:[],active:false},initialize:function(b){this.options=_.extend({},this.defaults,b,{view:this});b.data.on("change:activeMasters",this.changeMasters.bind(this));this.data=b.data;this.initializeJobTypes();this.rivets=rivets.bind(this.el,this.options);this.$el.removeClass("hidden");this.options.active=true;this.changeMasters()},initializeJobTypes:function(){_.each(a.categories,function(b){_.each(b.types,function(c){c.link="job-type-"+c.id;c.href="#job-type-"+c.id})})},changeMasters:function(){_.each(this.data.get("activeMasters"),function(b){b.on("change:active",this.checkMasterTypes.bind(this))}.bind(this));this.checkMasterTypes()},checkMasterTypes:function(){var b={};_.each(this.options.types,function(){this.options.types.pop()}.bind(this));_.each(this.data.get("activeMasters"),function(c){if(c.get("active")){_.each(c.get("types"),function(d){b[d]=true})}});b=_.keys(b);if(a.categories[this.data.get("activeCat")]){_.each(a.categories[this.data.get("activeCat")].types,function(c){_.each(c.jobTypes,function(d){if(b.indexOf(d.id.toString())>=0){c.active=true;c.jobs=_.toArray(c.jobTypes)}}.bind(this));this.options.types.push(c)}.bind(this))}},disactivateJobTypes:function(){_.each(a.categories,function(b){_.each(b.types,function(c){_.each(c.jobTypes,function(d){d.active=false})})})},selectJobType:function(f,c){f.preventDefault(true);var b=$(f.target).attr("data-type");var g=$(f.target).attr("data-id");var d=a.categories[c.view.data.get("activeCat")].types[b].jobTypes[g];if(!d.active){c.view.data.set("activeJob",d);c.view.prepareJob(d);c.view.disactivateJobTypes();d.active=true;_.each(c.view.data.get("activeMasters"),function(e){if(e.get("types").indexOf(d.id)<0){e.set("active",false)}})}else{d.active=false;_.each(c.view.data.get("activeMasters"),function(e){e.set("active",true)});c.view.data.set("activeDurations",{});c.view.data.set("activeJob",{})}c.view.data.set("message","Выерите удобное время")},prepareJob:function(c){var b={};if(c.price){if(c.price.customDuration){_.each(c.price.customDuration,function(d){b[d.evenMaster.id]=parseInt(d.duration)}.bind(this))}else{}}this.data.set("activeDurations",b)},clickParent:function(c,b){c.target=$(c.target).parent()[0];b.view.selectJobType(c,b)}})};