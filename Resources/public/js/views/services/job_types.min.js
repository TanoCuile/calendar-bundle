function initializeJobTypesView(a){a.JobTypesView=Backbone.View.extend({types:[],active:false,cat:null,rivets:null,activeJobTypes:{},currentJobType:null,initialize:function(b){this.$el.find(".job-type").click(function(d){d.preventDefault();var c="";if(!$(d.target).hasClass("active")){$(d.target).addClass("active");c="addCol"}else{$(d.target).removeClass("active");c="removeCol"}a.categories.get($(d.target).attr("data-cat")).get("types").get($(d.target).attr("data-type")).get("service").get("prices").each(function(e){if(e.get("jobType")==parseInt($(d.target).attr("data-id"))){e.get("customDuration").each(function(f){a.calendar.widget[c](f);if(c=="removeCol"){a.categoriesView.disactivateMaster(f.get("evenMaster").get("id"))}})}})}.bind(this));this.rivets=rivets.bind(this.el,this);this.$el.removeClass("hidden");this.$message=this.$el.find(".message")},selectJobType:function(c,b){c.preventDefault(true);if(!$(c.target).hasClass("active")){a.jobTypesView.currentJobType=$(c.target).attr("data-id");b.activeJobTypes[a.jobTypesView.currentJobType]={job:$(c.target).attr("data-id"),type:$(c.target).attr("data-type")};_.each(b.types,function(d){if(d.type.id==$(c.target).attr("data-type")){_.each(d.jobTypes,function(e){if(e.id==a.jobTypesView.currentJobType){e.active=true}})}});a.categoriesView.selectJobType(b.activeJobTypes);a.calendar.showMessage("Выберите время")}else{delete b.activeJobTypes[$(c.target).attr("data-id")];if(a.jobTypesView.currentJobType&&a.jobTypesView.currentJobType==$(c.target).attr("data-id")){a.jobTypesView.currentJobType=null}_.each(b.types,function(d){if(d.type.id==$(c.target).attr("data-type")){_.each(d.jobTypes,function(e){if(e.id==$(c.target).attr("data-id")){e.active=false}})}});a.categoriesView.selectJobType(b.activeJobTypes)}},activate:function(f,b){this.active=true;this.cat=b;var e=_.toArray(f).length;if(e>0){var d=0;var c={};_.each(f,function(g){if(g.active){if(d==0){_.each(g.types,function(h,i){c[i]=h;_.each(c[i].jobTypes,function(k,j){if(this.activeJobTypes[k.id]){k.active=true}else{k.active=false}}.bind(this))}.bind(this))}else{_.each(g.types,function(h,i){if(!c[i]){c[i]=h}else{_.each(h.jobTypes,function(k,j){if(!c[i].jobTypes[j]){if(c[i].jobTypes){c[i].jobTypes={}}c[i].jobTypes[j]=k;if(this.activeJobTypes[k.id]){c[i].jobTypes[j].active=true}else{c[i].jobTypes[j].active=false}}}.bind(this))}}.bind(this))}++d}}.bind(this));_.each(this.types,function(g,h){this.types.pop()}.bind(this));_.each(c,function(g){g.jobTypes=_.toArray(g.jobTypes);this.types.push(g)}.bind(this))}else{_.each(this.types,function(g,h){this.types.pop()}.bind(this))}},clickParent:function(c,b){c.target=$(c.target).parent()[0];b.selectJobType(c,b)}})};